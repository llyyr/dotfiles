#!/bin/sh

export WINEPREFIX="$HOME/.wuwa_prefix"
export DXVK_HDR=1
export SteamOS=1
# export DXVK_CONFIG='dxgi.customDeviceDesc=\"AMD Radeon RX 6950 XT\";dxgi.customDeviceId=29631;dxgi.customVendorId=1002'
# export DXVK_CONFIG="dxgi.customDeviceDesc=\"AMD Radeon RX 7900 XTX\";dxgi.customDeviceId=29772;dxgi.customVendorId=1002"
# export DXVK_CONFIG="dxgi.customDeviceDesc=\"NVIDIA GeForce RTX 4090\";dxgi.customDeviceId=2684;dxgi.customVendorId=10de"
WINE_BIN="/opt/wine/bin/wine"
JADEITE_PATH="/mnt/g/jadeite_v5.0.1/jadeite.exe"
LAUNCHER_PATH="/mnt/g/Wuthering Waves/launcher.exe"
GAME_PATH="/mnt/g/Wuthering Waves/Wuthering Waves Game/Client/Binaries/Win64/Client-Win64-Shipping.exe"

DX_MODE="-dx11"
X11=0

while [[ $# -gt 0 ]]; do
    case "$1" in
        -dx11|-dx12) DX_MODE="$1" ;;
        -x11) X11=1 ;;
        launcher) MODE="launcher" ;;
    esac
    shift
done

[[ $X11 -eq 0 && "$MODE" != "launcher" ]] && unset DISPLAY

if [[ "$MODE" == "launcher" ]]; then
    export WINEDLLOVERRIDES="KRInstallExternal.exe=d"
    exec "$WINE_BIN" "$LAUNCHER_PATH"
else
    export WINEDLLOVERRIDES="KRSDKExternal.exe=d"
    # exec "$WINE_BIN" "$JADEITE_PATH" "$GAME_PATH" -- "$DX_MODE" -SkipSplash
    exec "$WINE_BIN" "$GAME_PATH" -- "$DX_MODE" -SkipSplash
fi
